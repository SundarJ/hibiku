const Promise = require('bluebird');
const db = require('../../db');

const JSCK = require('jsck');
const fs = require('fs');
const path = require('path');

const schema = JSON.parse(fs.readFileSync(path.join(__dirname,'schema.json'), 'utf-8'));
const jsck = new JSCK.draft4(schema);

module.exports = function(req, res) {
    if (this.request.headers.accept === 'application/json' && this.request.headers['content-type'] === 'application/json; charset=UTF-8') {
        var validated = jsck.validate(req.body);
        if (validated.valid) {
            this.body = validated;
        } else {
            this.status = 400;
            this.body = {
                error: "bad request",
                jsck: validated
            };
        }
    } else {
        this.status = 400;
        this.body = {"error": "bad request"};
    }
};
