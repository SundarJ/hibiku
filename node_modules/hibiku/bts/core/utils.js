const Promise = require('bluebird');
const fs = require('fs');
const readdirAsync = Promise.promisify(fs.readdir);
const statAsync = Promise.promisify(fs.stat);
const path = require('path');

function walk(viewsFolder) {
    return readdirAsync(viewsFolder).map(function(file) {
        var resolved = path.join(viewsFolder, file);
        return statAsync(resolved).then(function(stat) {
            return stat.isDirectory() ? walk(resolved) : resolved;
        });
    }).reduce(function (a, b) {
        return a.concat(b);
    }, []);
}

function filterTruthy(item) { return item };

function createRegExp(str, flags) {
  return new RegExp(str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&"), flags);
}

module.exports = {
    walk: walk,
    regex: {
        create: createRegExp
    },
    filter: {
        truthy: filterTruthy   
    }
}