start
  = template:template { return template }

template = anchor+

anchor =
  open t:tokens close [\n,]? { return t; }

open = '(('
close = '))'

tokens = tokens:[^()]+ 
  {
    var parts = tokens.join('').split(" ");
    var ret = {};
    parts.forEach(function(part) {
      if (part[0] === ':') {
        ret.helper = part;
      } else if (part[part.length-1] === '.') { // token is an end tag
        ret = false;
      } else if (part[0] === '>') {
        ret.token = 'include';
        ret.context = part.slice(1);
      } else {
        if (!ret.helper)
          ret.token = 'anchor';
        ret.context = ret.helper ? part : parts.join(" ");
      }
    });
    return ret;
  }